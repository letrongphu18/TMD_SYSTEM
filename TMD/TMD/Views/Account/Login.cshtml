<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng nhập - TMD System</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
	<link href="~/css/login.css" rel="stylesheet" />
</head>
<body>
    <div class="login-container">
        <!-- Left Side - Branding -->
        <div class="login-branding">
            <div class="branding-content">
                <div class="branding-icon">
                    <i class="fas fa-building"></i>
                </div>
                <h1 class="branding-title">TMD System</h1>
                <p class="branding-subtitle">Hệ thống quản lý nhân sự hiện đại</p>

                <div class="branding-features">
                    <div class="feature-item">
                        <div class="feature-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="feature-text">
                            Chấm công thông minh với GPS và nhận diện khuôn mặt
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="feature-text">
                            Quản lý công việc và dự án hiệu quả
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="feature-text">
                            Báo cáo và thống kê chi tiết theo thời gian thực
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Side - Login Form -->
        <div class="login-form-section">
            <div class="form-header">
                <h2>Chào mừng trở lại!</h2>
                <p>Đăng nhập để tiếp tục sử dụng hệ thống</p>
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Tên đăng nhập</label>
                    <div class="input-group">
                        <i class="fas fa-user input-icon"></i>
                        <input type="text"
                               id="username"
                               class="form-control"
                               placeholder="Nhập tên đăng nhập của bạn"
                               required
                               autocomplete="username" />
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Mật khẩu</label>
                    <div class="input-group">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password"
                               id="password"
                               class="form-control"
                               placeholder="Nhập mật khẩu của bạn"
                               required
                               autocomplete="current-password" />
                        <button type="button" class="password-toggle" id="togglePassword">
                            <i class="fas fa-eye" id="toggleIcon"></i>
                        </button>
                    </div>
                </div>

                <div class="form-options">
                    <div class="custom-checkbox">
                        <input type="checkbox" id="rememberMe" />
                        <label for="rememberMe">Ghi nhớ đăng nhập</label>
                    </div>
                    <a href="#" class="forgot-password">Quên mật khẩu?</a>
                </div>

                <button type="submit" class="btn-login" id="btnLogin">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Đăng nhập</span>
                </button>
            </form>

            <div class="divider">
                <span>hoặc đăng nhập với</span>
            </div>

            <div class="social-login">
                <button type="button" class="btn-social">
                    <i class="fab fa-google"></i>
                    Google
                </button>
                <button type="button" class="btn-social">
                    <i class="fab fa-microsoft"></i>
                    Microsoft
                </button>
            </div>

            <div class="footer-text">
                &copy; 2024 TMD System. All rights reserved.
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        // Toggle Password Visibility
        const togglePassword = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('password');
        const toggleIcon = document.getElementById('toggleIcon');

        togglePassword.addEventListener('click', function() {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);

            if (type === 'password') {
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            } else {
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            }
        });

        // Login Form Submit
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            const btnLogin = document.getElementById('btnLogin');

            if (!username || !password) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Thiếu thông tin',
                    text: 'Vui lòng nhập đầy đủ tên đăng nhập và mật khẩu',
                    confirmButtonColor: '#E74C3C'
                });
                return;
            }

            // Show loading state
            btnLogin.classList.add('loading');
            btnLogin.innerHTML = '<i class="fas fa-spinner"></i><span>Đang đăng nhập...</span>';

            try {
                const response = await fetch('/Account/LoginJson', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password, rememberMe })
                });

                const result = await response.json();

                if (result.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Thành công!',
                        text: result.message,
                        confirmButtonColor: '#27AE60',
                        timer: 1500,
                        showConfirmButton: false
                    }).then(() => {
                        window.location.href = result.redirectUrl;
                    });
                } else {
                    btnLogin.classList.remove('loading');
                    btnLogin.innerHTML = '<i class="fas fa-sign-in-alt"></i><span>Đăng nhập</span>';

                    Swal.fire({
                        icon: 'error',
                        title: 'Đăng nhập thất bại',
                        text: result.message,
                        confirmButtonColor: '#E74C3C'
                    });
                }
            } catch (error) {
                btnLogin.classList.remove('loading');
                btnLogin.innerHTML = '<i class="fas fa-sign-in-alt"></i><span>Đăng nhập</span>';

                Swal.fire({
                    icon: 'error',
                    title: 'Lỗi!',
                    text: 'Có lỗi xảy ra. Vui lòng thử lại.',
                    confirmButtonColor: '#E74C3C'
                });
            }
        });

        // Prevent form resubmission on page refresh
        if (window.history.replaceState) {
            window.history.replaceState(null, null, window.location.href);
        }
    </script>
</body>
</html>